---
title: 'This NextJS portfolio site'
description: 'Creating a static site with NextJS and MDX'
date: '2024/2/20'
---

# Introduction

This site was created to help document my learning journey and this post explains how I built it.

# Building the site

My main requirements are:

1. Static site (low cost)
2. Flexibility for customization
3. Simple workflow to write and display posts

NextJS fits my requirements well because it has static site generation capabilities, has support for MDX, and is easily customizable as it is a React framework. This also means that I can develop and write posts for the site in a single project.

I've considered other static site generators or other CMS solutions but they are either not easily customizable or too overkill for my use case.

So below are some of the key features that I had to build and configure.

## How to write and display posts

First, I had to figure out a way to write posts and display them. NextJS supports MDX out of the box. So you can write your posts directly in MDX and it will show up as a page. However, for better separation between site content and source code, I prefer to manually parse and render the MDX file using the `next-mdx-remote` library. 

The `next-mdx-remote` library converts MDX files to HTML tags which you can then render using React. The library has a feature to replace generated HTML tags with your custom components based on the type of tag generated (eg. h1, h2, code). This is useful for adding customizations to the posts.

Another cool thing about MDX is that it allows me to embed custom react components in the MDX file. This is useful for adding custom components to the posts in the future.

## Controlling how posts are rendered

With the above setup, I was able to easily add additional customizations on the posts on this site.

### Using frontmatter to add metadata to posts

Posts on the site need to have metadata (Eg. publish date...) for display and sorting purposes. For this, I just had to add frontmatter to the markdown posts and then the `next-mdx-remote` library will pass it to me with the generated MDX post.

```mdx
---
title: 'This NextJS portfolio site'
description: 'Creating a static site with NextJS and MDX'
date: '7/2/24'
---
```

### Generating a Table of Contents for all posts

In markdown, there is no syntax for a "table of contents" which generates a table of internal HTML links that you can click to navigate to the specific heading in the post.

```html
<a href="#id">My first blog post</a>
...
<h1 id="id">My first blog post</h1>
```

There are plugins for `next-mdx-remote` like `rehype-slug` which can [generate slugs/ids for each heading and add it to the heading tag](https://mikebifulco.com/posts/mdx-auto-link-headings-with-rehype-slug#step-1-generate-ids-for-all-headings-automatically-with-rehype-slug), making them linkable. The problem is that I can't access the generated slugs to generate the table of contents.

```html
// rehype-slug 
<h1 id="my-first-blog-post">My first blog post</h1>
```

An alternative is to manually write the table of contents for each post in HTML, directly in the MDX file. However, this is error prone and styling will not be straight forward.

So I had to manually parse the headings in the MDX file and generate slugs for each heading. Then I had to make sure the heading tags generated by `next-mdx-remote` have the id attributes containing the matching slugs. This is done by passing the library a component mapping like this.

```tsx
export const headingComponentMapping = {
  h1: ({ children }: HTMLAttributes<HTMLHeadingElement>) => (
    <h1 id={generateHeadingSlug(children as string)}>{children} </h1>
  ),
  h2: ({ children }: HTMLAttributes<HTMLHeadingElement>) => (
    <h2 id={generateHeadingSlug(children as string)}>{children} </h2>
  ),
  h3: ({ children }: HTMLAttributes<HTMLHeadingElement>) => (
    <h3 id={generateHeadingSlug(children as string)}>{children} </h3>
  ),
  h4: ({ children }: HTMLAttributes<HTMLHeadingElement>) => (
    <h4 id={generateHeadingSlug(children as string)}>{children} </h4>
  ),
  h5: ({ children }: HTMLAttributes<HTMLHeadingElement>) => (
    <h5 id={generateHeadingSlug(children as string)}>{children} </h5>
  ),
  h6: ({ children }: HTMLAttributes<HTMLHeadingElement>) => (
    <h6 id={generateHeadingSlug(children as string)}>{children} </h6>
  ),
}
```

Since I'm generating the heading slugs in code, I can render the table of contents in a react component (`PostTableOfContents`), and style it consistently.

### Adding syntax highlighting

In markdown, you can write code blocks but there is no syntax highlighting. So I had to use the `rehype-highlight` library to add syntax highlighting to the rendered code blocks. It will wrap portions of the code with the appropriate tags and CSS class names. These class names are compatible with `highlight.js` and I can use any `highlight.js` CSS stylesheet to apply the highlighting.

Since I had a dark mode on this site, I also had to dynamically change the `highlight.js` css file to respond to theme changes. This can be easily done using scss attribute selector with the `@include` directive.

```scss
// global.scss
/* I implemented dark mode by changing the class name of the body tag
 * so I just had to load the appropriate css file when the class
 * name is either 'dark' or 'light', using scss's @include directive
 * and attribute presence selector
 */

body[class='dark'] {
  @include meta.load-css('../styles/highlight-js/github-dark-dimmed.css');
}

body[class='light'] {
  @include meta.load-css('../styles/highlight-js/github.css');
}
```

## Displaying post previews

To generate preview lists for my blogs and projects, I just needed to sort the posts and do some simple pagination.

## Dark mode

After googling through many ways to implement dark mode in react, I realized that the easiest and most straight forward way to do it is through CSS variables. So I just had to define generic colour variables with the required colours and then use the variables throughout the app. The theme can be toggled easily by applying the appropriate variable definitions to the root element (Eg. body tag)

```scss
.light {
  --bg-color: var(--gray1);
  --primary-surface-color: var(--gray2);
  --secondary-surface-color: var(--gray2);
  --text-color: var(--gray6);
  --border-color: var(--blue);
}

.dark {
  --bg-color: var(--gray5);
  --primary-surface-color: var(--gray3);
  --secondary-surface-color: var(--gray6);
  --text-color: var(--gray0);
  --border-color: var(--purple);
}
```

## Hosting

Hosting is free using github pages, I just had to configure the github actions to build the site and deploy the static assets. Github provides a pre-made .yml file for it. However, you need to remove the `next export` command from the .yml file because it is replaced with the `output: 'export'` option in the `next.config.js` file for static site generation.

# Conclusion

Through this project I was able to practice using react, typescript, SASS and I was also able to familiarize myself with NextJs concepts (Eg. App router, dynamic routes, ...).

I hope to add improvements to the site in the future, for example:

- Search bar
- Post tags
- Analytics
- Converting SCSS files to styled components (because it makes code cleaner, reduces the number of files and support SCSS at the same time)

# Code

Source code can be found in my github repo [here](https://github.com/wmwm101010/wmwm101010.github.io)
